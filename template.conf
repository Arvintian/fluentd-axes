<source>
    @type forward
</source>

{{range $k, $item := .Targets}}
<match {{ $item.target }}>
    @type copy

    <store>
        @type kafka_buffered
        brokers {{ $item.brokers }}
        default_topic {{ $item.topic }}
        flush_interval {{ $item.interval }}s
    </store>

</match>
{{end}}

<match **>
    @type copy

    <store>
        @type kafka_buffered
        brokers {{ .DefaultTarget.brokers }}
        default_topic {{ .DefaultTarget.topic }}
        flush_interval {{ .DefaultTarget.interval }}
    </store>

</match>